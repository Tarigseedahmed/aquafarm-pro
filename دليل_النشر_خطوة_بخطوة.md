# 🚀 دليل النشر خطوة بخطوة - Step by Step Deployment

## معلومات الاتصال

```
IP: 72.60.187.58
Domain: srv1029413.hstgr.cloud
Username: root
Password: Tariq2024Tariq2026@#
Location: France - Paris
OS: Ubuntu 24.04 with Docker
```

---

## ✅ الخطوة 1: اختبار الاتصال (5 دقائق)

### أ) افتح PowerShell

اضغط `Win + X` واختر **Windows PowerShell** أو **Terminal**

### ب) اختبر الاتصال

```powershell
# انتقل لمجلد المشروع
cd "f:\Aqua Pro"

# اختبر الاتصال بالخادم
.\scripts\test-vps-connection.ps1
```

**المتوقع:** رسالة "تم الاتصال بنجاح!"

**إذا فشل:**
- تحقق من الإنترنت
- تحقق من أن IP صحيح: `72.60.187.58`
- تحقق من أن كلمة المرور صحيحة

---

## 🔧 الخطوة 2: النشر التلقائي (15-20 دقيقة)

### أ) شغّل سكريبت النشر

```powershell
# من مجلد المشروع
cd "f:\Aqua Pro"

# شغّل النشر
.\scripts\deploy-to-vps.ps1
```

### ب) راقب التقدم

السكريبت سيقوم تلقائياً بـ:

1. **اختبار الاتصال** ✅
2. **تحديث النظام** (2-3 دقائق) ⏳
3. **تثبيت Docker** (2-3 دقائق) ⏳
4. **تثبيت Docker Compose** (1 دقيقة) ⏳
5. **إعداد الجدار الناري** ✅
6. **إنشاء المجلدات** ✅
7. **رفع الملفات** (3-5 دقائق) ⏳
8. **إعداد البيئة** ✅
9. **إنشاء شهادات SSL** ✅
10. **بناء وتشغيل التطبيق** (5-7 دقائق) ⏳

### ج) انتظر رسالة النجاح

```
========================================
   تم النشر بنجاح! 🎉
========================================
```

---

## ✨ الخطوة 3: التحقق من التطبيق (2 دقائق)

### أ) افتح المتصفح

اذهب إلى:

```
http://72.60.187.58
```

**المتوقع:** صفحة التطبيق تفتح

### ب) اختبر API

```
http://72.60.187.58/api
http://72.60.187.58/health
```

**المتوقع:** استجابة JSON

### ج) اختبر من الخادم

```powershell
# اتصل بالخادم
ssh root@72.60.187.58

# اختبر الخدمات
curl http://localhost:3000/health
curl http://localhost:3001
curl http://localhost/health

# اعرض حالة الحاويات
cd /root/aquafarm-pro
docker-compose -f docker-compose.hostinger.yml ps

# اخرج
exit
```

---

## 🎯 الخطوة 4: الإعدادات الإضافية (اختياري)

### أ) تحديث Domain في ملف البيئة

إذا كنت تريد استخدام اسم النطاق `srv1029413.hstgr.cloud`:

```powershell
ssh root@72.60.187.58
```

```bash
cd /root/aquafarm-pro
nano .env
```

غيّر:
```env
DOMAIN=72.60.187.58
CORS_ORIGIN=http://72.60.187.58
NEXT_PUBLIC_API_URL=http://72.60.187.58/api
```

إلى:
```env
DOMAIN=srv1029413.hstgr.cloud
CORS_ORIGIN=http://srv1029413.hstgr.cloud
NEXT_PUBLIC_API_URL=http://srv1029413.hstgr.cloud/api
```

احفظ: `Ctrl+X` ثم `Y` ثم `Enter`

```bash
# أعد تشغيل الحاويات
docker-compose -f docker-compose.hostinger.yml restart
```

### ب) إضافة شهادة SSL حقيقية (Let's Encrypt)

```bash
# اتصل بالخادم
ssh root@72.60.187.58

# ثبّت Certbot
apt install -y certbot

# احصل على شهادة
certbot certonly --standalone -d srv1029413.hstgr.cloud

# انسخ الشهادات
cp /etc/letsencrypt/live/srv1029413.hstgr.cloud/fullchain.pem /root/aquafarm-pro/ssl/cert.pem
cp /etc/letsencrypt/live/srv1029413.hstgr.cloud/privkey.pem /root/aquafarm-pro/ssl/key.pem

# أعد تشغيل Nginx
cd /root/aquafarm-pro
docker-compose -f docker-compose.hostinger.yml restart nginx
```

الآن يمكنك الوصول عبر HTTPS:
```
https://srv1029413.hstgr.cloud
```

---

## 📊 الخطوة 5: المراقبة والصيانة

### أ) عرض السجلات

```powershell
# اتصل بالخادم
ssh root@72.60.187.58

# عرض جميع السجلات
cd /root/aquafarm-pro
docker-compose -f docker-compose.hostinger.yml logs -f

# عرض سجلات خدمة معينة
docker logs aquafarm-backend -f
docker logs aquafarm-frontend -f
```

للخروج اضغط: `Ctrl+C`

### ب) إعادة التشغيل

```bash
cd /root/aquafarm-pro
docker-compose -f docker-compose.hostinger.yml restart
```

### ج) إيقاف التطبيق

```bash
cd /root/aquafarm-pro
docker-compose -f docker-compose.hostinger.yml down
```

### د) تشغيل التطبيق

```bash
cd /root/aquafarm-pro
docker-compose -f docker-compose.hostinger.yml up -d
```

---

## 🔄 الخطوة 6: تحديث التطبيق (في المستقبل)

### طريقة 1: من جهازك المحلي

```powershell
# من مجلد المشروع
cd "f:\Aqua Pro"

# شغّل النشر مرة أخرى
.\scripts\deploy-to-vps.ps1
```

### طريقة 2: يدوياً

```powershell
# على جهازك المحلي
cd "f:\Aqua Pro"

# أنشئ أرشيف جديد
tar -czf aquafarm-update.tar.gz --exclude=node_modules --exclude=.git --exclude="*.log" .

# ارفعه للخادم
scp aquafarm-update.tar.gz root@72.60.187.58:/root/aquafarm-pro/

# اتصل بالخادم
ssh root@72.60.187.58
```

```bash
# على الخادم
cd /root/aquafarm-pro

# إيقاف التطبيق
docker-compose -f docker-compose.hostinger.yml down

# استخراج التحديثات
tar -xzf aquafarm-update.tar.gz
rm aquafarm-update.tar.gz

# تشغيل التطبيق المحدّث
docker-compose -f docker-compose.hostinger.yml up -d --build

# عرض السجلات
docker-compose -f docker-compose.hostinger.yml logs -f
```

---

## 🔐 الخطوة 7: النسخ الاحتياطي

### نسخ احتياطي لقاعدة البيانات

```bash
# اتصل بالخادم
ssh root@72.60.187.58

# أنشئ نسخة احتياطية
cd /root/aquafarm-pro
docker exec aquafarm-postgres pg_dump -U aquafarm_user aquafarm_prod > backups/backup_$(date +%Y%m%d_%H%M%S).sql

# ضغط النسخة
gzip backups/backup_*.sql
```

### استعادة من نسخة احتياطية

```bash
# اتصل بالخادم
ssh root@72.60.187.58

cd /root/aquafarm-pro

# فك ضغط النسخة
gunzip backups/backup_YYYYMMDD_HHMMSS.sql.gz

# استعادة
docker exec -i aquafarm-postgres psql -U aquafarm_user -d aquafarm_prod < backups/backup_YYYYMMDD_HHMMSS.sql
```

---

## ❌ حل المشاكل الشائعة

### المشكلة: التطبيق لا يفتح

```bash
# تحقق من حالة الحاويات
docker-compose -f docker-compose.hostinger.yml ps

# تحقق من السجلات
docker logs aquafarm-backend --tail 100
docker logs aquafarm-nginx --tail 100
```

### المشكلة: خطأ في الاتصال بقاعدة البيانات

```bash
# تحقق من PostgreSQL
docker exec aquafarm-postgres pg_isready -U aquafarm_user

# تحقق من السجلات
docker logs aquafarm-postgres --tail 100
```

### المشكلة: منفذ مستخدم

```bash
# اعرض المنافذ المستخدمة
netstat -tuln | grep -E ':(80|443|3000|3001|5432)'

# أوقف الحاويات القديمة
docker stop $(docker ps -aq)

# أعد التشغيل
docker-compose -f docker-compose.hostinger.yml up -d
```

### المشكلة: مساحة القرص ممتلئة

```bash
# تحقق من المساحة
df -h

# نظّف Docker
docker system prune -a --volumes

# احذف السجلات القديمة
find /root/aquafarm-pro/logs -name "*.log" -mtime +7 -delete
find /root/aquafarm-pro/backups -name "*.sql.gz" -mtime +30 -delete
```

---

## 📞 معلومات مهمة

### روابط الوصول

- **التطبيق**: http://72.60.187.58
- **API**: http://72.60.187.58/api
- **API Docs**: http://72.60.187.58/api/docs
- **Health Check**: http://72.60.187.58/health
- **Prometheus**: http://72.60.187.58:9090
- **Grafana**: http://72.60.187.58:3002

### بيانات الدخول الافتراضية

**قاعدة البيانات:**
- Database: `aquafarm_prod`
- User: `aquafarm_user`
- Password: `aquafarm_secure_password_123`

**Grafana:**
- Username: `admin`
- Password: `grafana_admin_secure_password_123`

⚠️ **مهم:** غيّر جميع كلمات المرور في بيئة الإنتاج!

---

## ✅ قائمة التحقق النهائية

- [ ] التطبيق يفتح في المتصفح
- [ ] API تستجيب: `/health` و `/api`
- [ ] قاعدة البيانات تعمل
- [ ] Redis يعمل
- [ ] Nginx يعمل
- [ ] السجلات لا توجد بها أخطاء
- [ ] جميع الحاويات تعمل: `docker-compose ps`
- [ ] الجدار الناري مفعّل: `ufw status`
- [ ] تم تغيير كلمات المرور الافتراضية
- [ ] تم إعداد النسخ الاحتياطي التلقائي

---

## 🎉 تهانينا!

تطبيق **AquaFarm Pro** الآن يعمل على VPS الخاص بك! 🐟

---

**للدعم والمساعدة:**
- 📧 Email: support@aquafarm.pro
- 📚 Documentation: [README.md](./README.md)
- 🔧 Scripts: [scripts/README_DEPLOYMENT.md](./scripts/README_DEPLOYMENT.md)

---

**تاريخ آخر تحديث:** October 2, 2025
